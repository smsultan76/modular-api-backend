<!DOCTYPE html>
<html>
<body>
<h2>Web Push Test</h2>
<button id="subBtn">Enable Notifications</button>

<script>
const vapidPublicKey = "MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE66JxFim6TRxNpy7PF-ojQEcvDFROTvEqmfLE3EsbA_RkbrP9ro50k3OY8keiGC3DZpW22v7PdSJ0Lkd6ZWw00w";

navigator.serviceWorker.register('/sw.js');

document.getElementById('subBtn').onclick = async () => {

    const perm = await Notification.requestPermission();
    if (perm !== "granted") {
        alert("Permission Denied");
        return;
    }

    const reg = await navigator.serviceWorker.ready;

    const sub = await reg.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: vapidPublicKey
    });

    // Send subscription to Laravel
    await fetch('/api/save-subscription', {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(sub)
    });

    alert("Subscribed Successfully!");
};
</script>
</body>
</html>
